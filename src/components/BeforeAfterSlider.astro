---
// BeforeAfterSlider.astro
---

<section id="resultados" class="py-20 bg-cream relative overflow-hidden">
  <!-- Decorative background elements -->
  <div class="absolute top-10 left-10 w-64 h-64 bg-lavender-200/40 rounded-full blur-3xl animate-float"></div>
  <div class="absolute bottom-10 right-10 w-80 h-80 bg-lavender-100/50 rounded-full blur-3xl animate-float" style="animation-delay: -2s;"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="text-center max-w-2xl mx-auto mb-16 reveal">
      <div class="inline-flex items-center gap-2 bg-lavender-100 text-lavender-600 px-4 py-1.5 rounded-full text-sm font-medium mb-4">
        <span class="material-symbols-rounded text-[16px]">photo_camera</span>
        Casos de Éxito
      </div>
      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold font-[var(--font-heading)] text-lavender-700 mb-6">
        Sonrisas Transformadas
      </h2>
      <p class="text-gray-soft text-lg">
        Desliza para ver la diferencia. Resultados reales de pacientes que recuperaron su confianza con nosotros.
      </p>
    </div>

    <!-- Slider Container -->
    <div class="max-w-4xl mx-auto reveal" style="transition-delay: 200ms;">
      <div 
        class="relative w-full aspect-[4/3] sm:aspect-[16/9] rounded-2xl overflow-hidden shadow-2xl shadow-lavender-400/20 group cursor-ew-resize select-none"
        id="comparison-container"
      >
        <!-- "Before" Image (Background) -->
        <div class="absolute inset-0 bg-gray-200 flex flex-col items-center justify-center border-4 border-white rounded-2xl">
           <img 
            src="https://images.unsplash.com/photo-1606811841689-23df0cece3e9?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60" 
            alt="Antes del tratamiento dental" 
            class="w-full h-full object-cover rounded-xl"
            draggable="false"
            loading="lazy"
            decoding="async"
          />
          <div class="absolute top-4 left-4 bg-dark/70 backdrop-blur-sm text-white px-3 py-1 rounded-full text-xs font-semibold tracking-wider uppercase">Antes</div>
        </div>

        <!-- "After" Image (Foreground, clipped) -->
        <div 
          class="absolute inset-0 bg-lavender-50 flex flex-col items-center justify-center border-4 border-white rounded-2xl border-l-0 rounded-l-none"
          id="after-image-container"
          style="clip-path: inset(0 0 0 50%);"
        >
          <img 
            src="https://images.unsplash.com/photo-1588776814546-1ffcf47267a5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60" 
            alt="Después del tratamiento dental" 
            class="w-full h-full object-cover rounded-xl"
            draggable="false"
            loading="lazy"
            decoding="async"
          />
          <div class="absolute top-4 right-4 bg-lavender-500/90 backdrop-blur-sm text-white px-3 py-1 rounded-full text-xs font-semibold tracking-wider uppercase">Después</div>
        </div>

        <!-- Range Slider (Invisible, used for interaction) -->
        <input 
          type="range" 
          min="0" 
          max="100" 
          value="50" 
          class="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-20"
          id="slider-input"
          aria-label="Deslizar para ver el antes y el después"
        />

        <div 
          class="absolute top-0 bottom-0 w-1 bg-white cursor-ew-resize z-10 pointer-events-none drop-shadow-[0_0_5px_rgba(0,0,0,0.5)]"
          id="slider-line"
          style="left: 50%;"
        >
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full shadow-[0_0_15px_rgba(0,0,0,0.3)] flex items-center justify-center text-lavender-500 border-2 border-white/80 group-hover:scale-110 group-hover:bg-lavender-50 transition-transform duration-200">
            <span class="material-symbols-rounded text-[20px]">swap_horiz</span>
          </div>
        </div>
      </div>
      
      <p class="text-center text-xs text-gray-400 mt-4">* Imágenes demostrativas. Reemplazar con fotos clínicas reales.</p>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('comparison-container');
    const slider = document.getElementById('slider-input');
    const afterImage = document.getElementById('after-image-container');
    const sliderLine = document.getElementById('slider-line');

    if (slider && afterImage && sliderLine) {
      // Function to update the visual state based on input value
      const updateSlider = (val) => {
        // value is 0-100. We need to tell clip-path how much to cut from the LEFT.
        // If slider is at 20%, we reveal 80% of the 'after' image by clipping 20% from the left.
        afterImage.style.clipPath = `inset(0 0 0 ${val}%)`;
        sliderLine.style.left = `${val}%`;
      };

      // Listen for explicit range input events (drag/touch)
      slider.addEventListener('input', (e) => {
        const val = Number(e.target.value);
        updateSlider(val);
      });

      // Optional: Add hover sliding logic if desired (Tend style)
      // Usually, range input handles touch perfectly, so mousemove is just a bonus for desktop
      container?.addEventListener('mousemove', (e) => {
        // Only trigger if mouse is pressed down on the container
        if (e.buttons === 1) {
            const rect = container.getBoundingClientRect();
            let x = e.clientX - rect.left;
            x = Math.max(0, Math.min(x, rect.width)); // Clamp between 0 and width
            const percent = (x / rect.width) * 100;
            slider.value = percent.toString();
            updateSlider(percent);
        }
      });
    }
  });
</script>

<style>
  /* Ensure range track covers completely */
  input[type=range]::-webkit-slider-thumb {
    appearance: none;
    width: 40px;
    height: 100%;
    background: transparent;
    cursor: ew-resize;
  }
  input[type=range]::-moz-range-thumb {
    width: 40px;
    height: 100%;
    background: transparent;
    cursor: ew-resize;
    border: none;
  }
</style>
